
location /rspamd/css/ {
    proxy_pass http://127.0.0.1:{{ mail.rspamd.http_port }}/css/;
    proxy_set_header Host $host;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_set_header Accept-Encoding "";
    add_header X-Content-Type-Options "" always;
}

location /rspamd/js/ {
    proxy_pass http://127.0.0.1:{{ mail.rspamd.http_port }}/js/;
    proxy_set_header Host $host;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_set_header Accept-Encoding "";
    add_header X-Content-Type-Options "" always;
}

location /rspamd/images/ {
    proxy_pass http://127.0.0.1:{{ mail.rspamd.http_port }}/images/;
    proxy_set_header Host $host;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_set_header Accept-Encoding "";
    add_header X-Content-Type-Options "" always;
}

location /rspamd/ {
  auth_basic "Restricted Access";
  auth_basic_user_file /etc/nginx/locations-enabled/rspamd.htpasswd;

  proxy_pass http://127.0.0.1:{{ mail.rspamd.http_port }}/;
  proxy_set_header Host $host;
  proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
  proxy_set_header X-Forwarded-Proto $scheme;
  proxy_set_header Accept-Encoding "";

  sub_filter_types text/html;
  sub_filter_once off;
  sub_filter '<base href="/">' '<base href="/rspamd/">';
  
  # Disable nosniff
  add_header X-Content-Type-Options "" always;
}
